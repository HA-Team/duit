<div ng-controller="propsListingController as propsListing" id="propsListing">
  
  <!-- Desktop Content -->
  <div class="hidden-on-mobile">
    
    <div class="prop-listing-desktop-container">

      <!-- Sidebar -->
      <section class="prop-listing-sidebar">

        <h2>{{propsListing.sideBarParams.types.length == 1 ? propsListing.pluralize(propsListing.sideBarParams.types[0].type) : 'Inmuebles'}} {{propsListing.operationType.length == 1 ? 'en ' + propsListing.opName(propsListing.operationType[0]) : ''}}</h2>
        <p>{{propsListing.resultsCount}} resultados</p>

        <div class="prop-listing-tags" ng-if="propsListing.tags.length > 0">
          <p class="badge badge-default" ng-repeat="tag in propsListing.tags">
            {{tag.name}} <span class="badge badge-danger" ng-click="tag.action();"><i class="fa fa-times"></i></span>
          </p>
        </div>

        <!-- Order Section -->
        <div class="desktop-prop-listing-order" ng-class="{'open': propsListing.isOrderOpen}">
          <h4>Ordenar Publicaciones</h4>
          <p ng-click="propsListing.toggleOrderModal()" tabindex="-1" ng-blur="propsListing.isOrderOpen = false">{{propsListing.orderBy.text}}<i class="fas fa-angle-down"></i></p>
          <ul class="desktop-order-modal" >
            <li class="desktop-order-modal-item" ng-repeat="option in propsListing.orderOptions track by option.val" ng-click="propsListing.changeOrder(option)"
            ng-class="{' selected': option.val == propsListing.orderBy.val}">            
              <div>{{option.text}}</div>            
            </li>          
          </ul>
        </div>
        <!-- Order Section End -->

        <!-- Price Filter Section -->
        <div class="desktop-prop-listing-price">
          <h4>Precio</h4>
          <div class="desktop-prop-listing-price-items">
            <input type="number" min="0.00" step="0.01" placeholder="Mínimo" data-unit="USD" ng-model="propsListing.minPrice" ng-model-options='{ debounce: 1500 }' ng-change="propsListing.find()"> - 
            <input type="number" min="0.00" step="0.01" placeholder="Máximo" data-unit="USD" ng-model="propsListing.maxPrice" ng-model-options='{ debounce: 1500 }' ng-change="propsListing.find()">
          </div>
        </div>
        <!-- Price Filter Section End -->

        <!-- Operation Filter  -->
        <div class="margin-top-30">
          <h4>Operación</h4>
          <p class="badge badge-default" ng-if="propsListing.sideBarParams.operations.length == 1" ng-repeat="o in propsListing.sideBarParams.operations">
            {{propsListing.opName(o.operation_type)}} <span class="badge badge-danger" ng-click="propsListing.changeFilter({type: 'o', val: [1,2]})"><i class="fa fa-times"></i></span>
          </p>
          <p class="badge badge-info" ng-if="propsListing.sideBarParams.operations.length > 1" ng-repeat="o in propsListing.sideBarParams.operations"
            ng-click="propsListing.changeFilter({type: 'o', name: propsListing.opName(o.operation_type), val: [o.operation_type]})">
            {{propsListing.opName(o.operation_type)}} ({{o.count}})</i></span>
          </p>
        </div>
        <!-- Operation Filter End -->

        <!-- Type Filter -->
        <div class="margin-top-20">
          <h4>Tipo</h4>
          <p class="badge badge-default" ng-if="propsListing.sideBarParams.types.length == 1" ng-repeat="t in propsListing.sideBarParams.types">
            {{t.type}} <span class="badge badge-danger" ng-click="propsListing.changeFilter({type: 't', val: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25]})"><i class="fa fa-times"></i></span>
          </p>
          <p class="badge badge-info" ng-if="propsListing.sideBarParams.types.length > 1" ng-repeat="t in propsListing.sideBarParams.types" ng-click="propsListing.changeFilter({type: 't', name: t.type, val: [t.id]})">
            {{t.type}} ({{t.count}})</i></span>
          </p>
        </div>
        <!-- Type Filter End -->

        <!-- Condition Filter -->
        <div class="margin-top-20" ng-if="propsListing.sideBarParams.types.length == 1">
          <h4>Condición</h4>
          <p class="badge badge-default" ng-if="propsListing.sideBarParams.subTypes.length == 1" ng-repeat="st in propsListing.sideBarParams.subTypes">
            {{st.name}} <span class="badge badge-danger" ng-click="propsListing.changeFilter({type: 'st', val: []})"><i class="fa fa-times"></i></span>
          </p>
          <p class="badge badge-info" ng-if="propsListing.sideBarParams.subTypes.length > 1" ng-repeat="st in propsListing.sideBarParams.subTypes" ng-click="propsListing.changeFilter({type: 'st', name: st.name, val: [st.id]})">
            {{st.name}}</i></span>
          </p>
        </div>
        <!-- Condition Filter End -->

        <!-- Rooms Filter -->
        <div class="margin-top-20">
          <h4>Dormitorios</h4>
          <p class="badge badge-default" ng-if="propsListing.sideBarParams.rooms.length == 1" ng-repeat="r in propsListing.sideBarParams.rooms">
            {{propsListing.roomAmtName(r.amount)}}<span class="badge badge-danger" ng-click="propsListing.changeFilter({type: 'r', val: []})"><i class="fa fa-times"></i></span>
          </p>
          <p class="badge badge-info" ng-if="propsListing.sideBarParams.rooms.length > 1" ng-repeat="r in propsListing.sideBarParams.rooms" ng-click="propsListing.changeFilter({type: 'r', name: propsListing.roomAmtName(r.amount), val: ['suite_amount', '=', r.amount.toString()]})">
            {{propsListing.roomAmtName(r.amount)}} ({{r.count}})</i></span>
          </p>
        </div>
        <!-- Rooms Filter End -->

        <!-- Location Filter -->
        <div class="margin-top-20 prop-listing-location-filter">
          <h4>Ciudad / Barrio</h4>
          <p class="badge badge-default" ng-if="propsListing.sideBarParams.locations.length == 1" ng-repeat="l in propsListing.sideBarParams.locations">
            {{l.location_name}}<span class="badge badge-danger" ng-click="propsListing.changeFilter({type: 'l', val: []})"><i class="fa fa-times"></i></span>
          </p>
          <p class="badge badge-info" ng-if="propsListing.sideBarParams.locations.length > 1" ng-repeat="l in propsListing.sideBarParams.locations" ng-click="propsListing.changeFilter({type: 'l', name: l.location_name, val: [l.location_id]})">
            {{l.location_name}} ({{l.count}})</i></span>
          </p>          
        </div>

        <p class="props-listing-show-more-locations" ng-click="propsListing.toggleMoreLocations()" ng-if="propsListing.sideBarParams.locations.length > 9"><i class="fa fa-angle-down"></i></p>
        <!-- Location Filter End -->

      </section>    
      <!-- Sidebar / End -->

      <!-- Listing Container -->
      <section class="prop-listing-main">
        
        <skeleton-listing-card rows="3" lines="2" show-me="!propsListing.apiReady"></skeleton-listing-card>

        <div class="prop-listing-items-container" infinite-scroll="propsListing.loadMoreProps()" infinite-scroll-disabled="propsListing.stopInfiniteScroll" ng-show="propsListing.apiReady">
          
          <!-- Listing Item -->
          <article class="prop-listing-item-card" ng-repeat="p in propsListing.results">
            <a href="{{'/#!/property/' + p.id}}">
              <img src="{{p.cover_photo}}" alt="">            
            </a>
            
            <div class="prop-listing-card-content prop-listing-card-not-dev" ng-if="!p.development">
              <h5>{{p.price | currency:p.currency:0}}</h5> 
              <p>{{p.area > 0 ? (p.area | number:0) + 'm': ''}}<sup ng-show="p.area > 0">2</sup> {{p.rooms == 1 ? ( p.area > 0 ? '| ' : '') + p.rooms + ' Dormitorio' : p.rooms > 1 ? (p.area > 0 ? '| ' : '') + p.rooms + ' Dormitorios' : ''}}</p> 
              <p>{{p.full_prop.type.name}} en {{p.type}}</p> 
              <p>{{p.title}}</p> 
              <p>{{p.address}}</p>
            </div>

            <div class="prop-listing-card-content prop-listing-card-dev" ng-if="p.development">
              <p>Desde</p>
              <h5>{{p.price | currency:p.currency:0}}</h5> 
              <p>{{p.full_prop.type.name}} en {{p.type}}</p> 
              <p>{{p.development.name}}</p> 
              <p>{{p.address}}</p>
            </div>
          </article>
          <!-- Listing Item / End -->

          <skeleton-listing-card rows="1" lines="2" show-me="propsListing.loadingMore"></skeleton-listing-card>

        </div>
        <!-- Listings Container / End -->

      </section>
      <!-- Listing Container End -->

    </div>

  </div>
  <!-- Desktop Content End -->
  
  <!-- Mobile Content -->
  <div id="mobile-props-listing" class="container hidden-on-desktop" >    

    <!-- Mobile Filter Menu --> 
    <div class="d-flex flex-row mobile-filter-menu-container">      
      <div class="mobile-filter-menu-item">
        <div class="margin-right-10 mobile-filter-menu-icon" ng-click="propsListing.toggleOrderModal()">
          <i class="fa fa-long-arrow-down"></i>
          <i class="fa fa-long-arrow-up"></i>
        </div>        
        <h4 ng-click="propsListing.toggleOrderModal()">Ordenar</h4>
      </div> 
      <div class="vertical-line"></div>     
      <div class="mobile-filter-menu-item">
        <i class="fa fa-sliders margin-right-10 mobile-filter-menu-icon" ng-click="propsListing.toggleFilterModal()"></i>
        <h4 ng-click="propsListing.toggleFilterModal()">Filtrar</h4>
      </div>
    </div>
    <!-- Mobile Filter Menu End -->

    <!-- Mobile Order Modal -->    
    <div id="mobile-props-order-modal" ng-class="{' open': propsListing.isOrderOpen}">
      <div class="arrow-up"></div>
      <div class="mobile-order-modal-container">
        <h4>Ordenar por</h4>
        <ul>
          <li class="mobile-order-modal-item" ng-repeat="option in propsListing.orderOptions track by option.val" ng-click="propsListing.changeOrder(option)"
          ng-class="{' selected': option.val == propsListing.orderBy.val}">            
            <div>{{option.text}}</div>            
          </li>          
        </ul>
      </div>  
      <div class="mobile-modal-background" ng-click="propsListing.toggleOrderModal()"></div>    
    </div>
    <!-- Mobile Order Modal End -->

    <!-- Mobile Filter Modal -->    
    <div id="mobile-props-filter-modal" ng-class="{' open': propsListing.isFilterOpen}">
      <div class="arrow-up"></div>
      <div class="mobile-filter-modal-container">
        <div class="mobile-filter-modal-header">
          <h4>Filtrar por</h4>
          <p ng-click="propsListing.clearAllFilters()">Limpiar filtros</p>
        </div>        
        <ul>
          <!-- Filtro Precio -->
          <li class="mobile-filter-modal-item" ng-click="propsListing.toggleActiveItem($event)">    
            <div class="mobile-filter-item-text">
              <h5>Rango de Precio</h5>
              <p>
                {{!propsListing.maxPrice && propsListing.minPrice ? 'Más de ' + (propsListing.minPrice | currency:"$":0) :
                  !propsListing.minPrice && propsListing.maxPrice ? 'Menos de ' + (propsListing.maxPrice | currency:"$":0) :
                  propsListing.maxPrice && propsListing.minPrice ? 'Entre ' + (propsListing.minPrice | currency:"$":0) + ' y ' + (propsListing.maxPrice | currency:"$":0) : 'Todos'}}
              </p>
            </div>        
            <i class="fa fa-angle-down"></i>             
          </li> 
          <div class="mobile-filter-detail-container">
            <div class="price-filter mobile-filter-item-detail">            
              <!-- Min Price -->              
              <input type="number" placeholder="Mínimo" data-unit="USD" ng-model="propsListing.minPrice" ng-model-options='{ debounce: 1500 }' ng-change="propsListing.find()">              
              <!-- Max Price -->              
              <input type="number" placeholder="Máximo" data-unit="USD" ng-model="propsListing.maxPrice" ng-model-options='{ debounce: 1500 }' ng-change="propsListing.find()"> 
            </div>
          </div> 
          <!-- Filtro Precio End -->

          <!-- Filtro Operación -->
          <li class="mobile-filter-modal-item" ng-click="propsListing.toggleActiveItem($event)">                        
            <div class="mobile-filter-item-text">
              <h5>Operación</h5>  
              <p>{{propsListing.sideBarParams.operations.length == 1 ? 'Solo ' + propsListing.pluralize(propsListing.opName(propsListing.sideBarParams.operations[0].operation_type)) : 'Todos'}}</p>
            </div>        
            <i class="fa fa-angle-down"></i>         
          </li> 
          <div class="mobile-filter-detail-container">
            <div class="mobile-filter-item-detail">
              <h4 class="badge badge-default" ng-if="propsListing.sideBarParams.operations.length == 1" ng-repeat="o in propsListing.sideBarParams.operations">
                {{propsListing.opName(o.operation_type)}} <span class="badge badge-danger" ng-click="propsListing.changeFilter({type: 'o', val: [1,2]})"><i class="fa fa-times"></i></span>
              </h4>
              <h4 class="badge badge-info" ng-if="propsListing.sideBarParams.operations.length > 1" ng-repeat="o in propsListing.sideBarParams.operations"
                  ng-click="propsListing.changeFilter({type: 'o', val: [o.operation_type]})">
                {{propsListing.opName(o.operation_type)}} ({{o.count}})</i></span>
              </h4>
            </div>
          </div> 
          <!-- Filtro Operación End -->

          <!-- Filtro Tipo -->
          <li class="mobile-filter-modal-item" ng-click="propsListing.toggleActiveItem($event)">            
            <div class="mobile-filter-item-text">
              <h5>Tipo</h5>              
              <p>{{propsListing.sideBarParams.types.length == 1 ? 'Solo ' + propsListing.pluralize(propsListing.sideBarParams.types[0].type) : 'Todos'}}</p>
            </div>        
            <i class="fa fa-angle-down"></i>                       
          </li> 
          <div class="mobile-filter-detail-container">
            <div class="mobile-filter-item-detail">
              <h4 class="badge badge-default" ng-if="propsListing.sideBarParams.types.length == 1" ng-repeat="t in propsListing.sideBarParams.types">
                {{t.type}} <span class="badge badge-danger" ng-click="propsListing.changeFilter({type: 't', val: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25]})"><i class="fa fa-times"></i></span>
              </h4>
              <h4 class="badge badge-info" ng-if="propsListing.sideBarParams.types.length > 1" ng-repeat="t in propsListing.sideBarParams.types" ng-click="propsListing.changeFilter({type: 't', val: [t.id]})">
                {{t.type}} ({{t.count}})</i></span>
              </h4>
            </div>
          </div> 
          <!-- Filtro Tipo End -->

          <!-- Filtro Condición -->
          <li class="mobile-filter-modal-item" ng-click="propsListing.toggleActiveItem($event)" ng-if="propsListing.sideBarParams.types.length == 1">            
            <div class="mobile-filter-item-text">
              <h5>Condición</h5>              
              <p>{{propsListing.sideBarParams.subTypes.length == 1 ? 'Solo ' + propsListing.sideBarParams.subTypes[0].name : 'Todos'}}</p>
            </div>        
            <i class="fa fa-angle-down"></i>                       
          </li> 
          <div class="mobile-filter-detail-container" ng-if="propsListing.sideBarParams.types.length == 1">
            <div class="mobile-filter-item-detail">
              <h4 class="badge badge-default" ng-if="propsListing.sideBarParams.subTypes.length == 1" ng-repeat="st in propsListing.sideBarParams.subTypes">
                {{st.name}} <span class="badge badge-danger" ng-click="propsListing.changeFilter({type: 'st', val: []})"><i class="fa fa-times"></i></span>
              </h4>
              <h4 class="badge badge-info" ng-if="propsListing.sideBarParams.subTypes.length > 1" ng-repeat="st in propsListing.sideBarParams.subTypes" ng-click="propsListing.changeFilter({type: 'st', val: [st.id]})">
                {{st.name}}</i></span>
              </h4>
            </div>
          </div> 
          <!-- Filtro Condición End -->

          <!-- Filtro Ciudad / Barrio -->
          <li class="mobile-filter-modal-item" ng-click="propsListing.toggleActiveItem($event)">            
            <div class="mobile-filter-item-text">              
              <h5>Ciudad / Barrio</h5>   
              <p>{{propsListing.sideBarParams.locations.length == 1 ? 'Solo ' + propsListing.sideBarParams.locations[0].location_name : 'Todos'}}</p>
            </div>        
            <i class="fa fa-angle-down"></i>          
          </li>
          <div class="mobile-filter-detail-container">
            <div class="mobile-filter-item-detail">
              <h4 class="badge badge-default" ng-if="propsListing.sideBarParams.locations.length == 1" ng-repeat="l in propsListing.sideBarParams.locations">
                {{l.location_name}}<span class="badge badge-danger" ng-click="propsListing.changeFilter({type: 'l', val: []})"><i class="fa fa-times"></i></span>
              </h4>
              <h4 class="badge badge-info" ng-if="propsListing.sideBarParams.locations.length > 1" ng-repeat="l in propsListing.sideBarParams.locations" ng-click="propsListing.changeFilter({type: 'l', val: [l.location_id]})">
                {{l.location_name}} ({{l.count}})</i></span>
              </h4>
            </div>
          </div>  
          <!-- Filtro Ciudad / Barrio End -->

          <!-- Filtro Dormitorios -->
          <li class="mobile-filter-modal-item" ng-click="propsListing.toggleActiveItem($event)">            
            <div class="mobile-filter-item-text">              
              <h5>Dormitorios</h5>  
              <p>{{propsListing.sideBarParams.rooms.length == 1 ? 'Solo ' + propsListing.roomAmtName(propsListing.sideBarParams.rooms[0].amount) : 'Todos'}}</p>
            </div>        
            <i class="fa fa-angle-down"></i>           
          </li>  
          <div class="mobile-filter-detail-container">
            <div class="mobile-filter-item-detail">
              <h4 class="badge badge-default" ng-if="propsListing.sideBarParams.rooms.length == 1" ng-repeat="r in propsListing.sideBarParams.rooms">
                {{propsListing.roomAmtName(r.amount)}}<span class="badge badge-danger" ng-click="propsListing.changeFilter({type: 'r', val: []})"><i class="fa fa-times"></i></span>
              </h4>
              <h4 class="badge badge-info" ng-if="propsListing.sideBarParams.rooms.length > 1" ng-repeat="r in propsListing.sideBarParams.rooms" ng-click="propsListing.changeFilter({type: 'r', val: ['suite_amount', '=', r.amount.toString()]})">
                {{propsListing.roomAmtName(r.amount)}} ({{r.count}})</i></span>
              </h4>
          </div>
          </div>  
          <!-- Filtro Dormitorios End -->

        </ul>
      </div>  
      <div class="mobile-modal-background" ng-click="propsListing.toggleFilterModal()"></div>    
    </div>
    <!-- Mobile Filter Modal End -->

    <!-- Skeleton Loader -->
    <skeleton-listing rows="3" lines="2" show-me="!propsListing.apiReady"></skeleton-listing>
        
    <div ng-show="propsListing.apiReady" class="margin-top-30">

      <!-- Listings -->
      <div class="listings-container grid-layout-three" infinite-scroll="propsListing.loadMoreProps()" infinite-scroll-disabled="propsListing.stopInfiniteScroll">
        
        <!-- Listing Item -->
        <div class="" ng-repeat="p in propsListing.results">

          <!-- Not Development Properties -->
          <div class="mobile-list-card-container" ng-if="!p.development">
            <a href="/#!/property/{{p.id}}">
              <img class="mobile-list-card-img" src="{{p.photos[0].image}}" alt="" >
            </a>

            <div class="mobile-list-card-details d-flex flex-column">              
              <a href="/#!/property/{{p.id}}"><p>{{p.title}} - {{p.address}}</p></a>

              <span class="listing-price" ng-show="p.full_prop.web_price">{{p.price | currency:p.currency:0}}</span>
              
              <div class="mobile-card-icon-listing">
                <p>{{p.area | number : 0}} m<sup>2</sup> {{propsListing.doesPropertyHasEnvironments(p) ? '-' : ''}}</p>
                <div ng-if="propsListing.doesPropertyHasEnvironments(p)" class="d-flex">
                  <i class="fa fa-bed"></i><p>&nbsp{{p.rooms}}</p>
                  <i class="fa fa-bath"></i><p>&nbsp{{p.baths}}</p>
                  <i class="fa fa-car"></i><p>&nbsp{{p.parkings}}</p>
                </div>
              </div>
            </div>    
          </div>
          <!-- Not Development Properties End -->
          
          <!-- Development Properties -->
          <div ng-if="p.development" class="mobile-list-card-container" ng-if="!p.development">
            <a href="/#!/property/{{p.id}}">
              <img class="mobile-list-card-img" src="{{p.photos[0].image}}" alt="" >
            </a>

            <div class="mobile-list-card-details d-flex flex-column">              
              <a href="/#!/property/{{p.id}}"><p>{{p.development.name}} - {{p.development.address}}</p></a>

              <p>{{propsListing.pluralize(p.full_prop.type.name)}} desde:</p>
              <span class="listing-price" ng-show="p.full_prop.web_price">{{p.price | currency:p.currency:0}}</span>            
            </div>    
          </div>  
          <!-- Development Properties End -->

          <hr>
        </div>
        <!-- Listing Item / End -->

      </div>
      <!-- Listings Container / End -->

      <div class="clearfix"></div>
    </div>

    <!-- Skeleton Loader -->
    <skeleton-listing rows="3" lines="2" show-me="propsListing.loadingMore"></skeleton-listing>
 
  </div>
  <!-- Mobile Content End -->

  <div class="row fullwidth-layout text-center no-results" ng-hide="propsListing.ifResults">
    <i class="fa fa-5x fa-frown-o"></i>
    <h3>¡Ups! No hay nada aquí. ¡<a href="#!/contactUs">Contactános</a> para ver mas opciones!</h3>
  </div>
      
</div>